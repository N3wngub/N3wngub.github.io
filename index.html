<!DOCTYPE html>
<html lang="th">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>แหล่งท่องเที่ยวใกล้ฉัน</title>

  <link rel="icon" href="https://i.imgur.com/mfMYYCm.png" type="image/png">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
  
  <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCQL5ih5AtlUELIG7Filv3EgVWXRGWkR4g" async defer></script>

  <style>
    body {
      background-color: #f8f9fa;
    }

    #map {
      height: 500px;
      width: 100%;
      margin-top: 20px;
    }

    .card img {
      height: 200px;
      object-fit: cover;
    }
  </style>

  <script>
    let map, service, infowindow;

    function initMap(lat, lon) {
      const location = new google.maps.LatLng(lat, lon);

      map = new google.maps.Map(document.getElementById("map"), {
        center: location,
        zoom: 15,
      });

      const request = {
        location: location,
        radius: '5000',
        type: ['tourist_attraction']
      };

      service = new google.maps.places.PlacesService(map);
      service.nearbySearch(request, (results, status) => {
        if (status === google.maps.places.PlacesServiceStatus.OK) {
          displayPlaces(results); // แสดงผลในรูปแบบการ์ด
        } else {
          alert("ไม่สามารถโหลดสถานที่ได้: " + status);
        }
      });
    }

    function displayPlaces(places) {
      const container = document.getElementById("places-container");
      container.innerHTML = ""; // ล้างข้อมูลเดิม

      places.forEach(place => {
        const photoUrl = place.photos ? place.photos[0].getUrl() : "https://via.placeholder.com/400";
        const card = `
          <div class="col-md-4 mb-4">
            <div class="card shadow-sm">
              <img src="${photoUrl}" class="card-img-top" alt="${place.name}">
              <div class="card-body">
                <h5 class="card-title">${place.name}</h5>
                <p class="card-text">${place.vicinity || 'ไม่มีที่อยู่ระบุ'}</p>
                <button class="btn btn-primary" onclick="openOnMap(${place.geometry.location.lat()}, ${place.geometry.location.lng()})">ดูบนแผนที่</button>
              </div>
            </div>
          </div>
        `;
        container.innerHTML += card;
      });
    }

    function openOnMap(lat, lon) {
      const location = new google.maps.LatLng(lat, lon);
      map.setCenter(location);
      map.setZoom(18);
    }

    function getLocation() {
      if (navigator.geolocation) {
        navigator.geolocation.getCurrentPosition(showPosition, showError);
      } else {
        document.getElementById("location").innerText = "เบราว์เซอร์ของคุณไม่รองรับการใช้งานตำแหน่ง";
      }
    }

    function showPosition(position) {
      const lat = position.coords.latitude;
      const lon = position.coords.longitude;
      document.getElementById("location").innerText = `ละติจูด: ${lat} ลองจิจูด: ${lon}`;
      initMap(lat, lon);
    }

    function showError(error) {
      const errors = {
        1: "ผู้ใช้ปฏิเสธการใช้งานตำแหน่ง",
        2: "ข้อมูลตำแหน่งไม่พร้อมใช้งาน",
        3: "หมดเวลารอข้อมูลตำแหน่ง",
        0: "เกิดข้อผิดพลาดที่ไม่ทราบสาเหตุ"
      };
      document.getElementById("location").innerText = errors[error.code] || "ข้อผิดพลาดไม่ทราบสาเหตุ";
    }
  </script>
</head>

<body>
  <div class="container">
    <header class="d-flex flex-wrap justify-content-between align-items-center py-3 mb-4 border-bottom">
      <a href="/" class="d-flex align-items-center mb-3 mb-md-0 me-md-auto text-decoration-none">
        <img src="https://i.imgur.com/mfMYYCm.png" alt="Logo" width="100" height="50">
      </a>
      <ul class="nav nav-pills">
        <li class="nav-item"><a href="index.html" class="nav-link active" aria-current="page">Home</a></li>
        <li class="nav-item"><a href="#" class="nav-link">Features</a></li>
        <li class="nav-item"><a href="#" class="nav-link">Pricing</a></li>
        <li class="nav-item"><a href="about me.html" class="nav-link">About</a></li>
      </ul>
    </header>

    <div class="text-center my-4">
      <h1>แหล่งท่องเที่ยวใกล้ฉัน</h1>
      <button onclick="getLocation()" class="btn btn-primary btn-lg">แสดงตำแหน่งของฉัน</button>
      <p id="location" class="mt-2">กดปุ่มเพื่อดูตำแหน่งของคุณ</p>
    </div>

    <div id="map"></div>

    <div class="row mt-4" id="places-container">
      <!-- การ์ดสถานที่จะถูกสร้างที่นี่ -->
    </div>
  </div>
</body>

</html>